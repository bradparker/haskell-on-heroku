#!/usr/bin/env bash

set -exu

app_name=$1
result=$(nix-build --no-out-link --argstr name $app_name release.nix)

if [ -x "$(command -v docker)" ]; then
  docker load < $result
  docker tag $app_name registry.heroku.com/$app_name/web
  docker push registry.heroku.com/$app_name/web
else
  echo "Docker is required to deploy"
  exit 1
fi

if [ -x "$(command -v heroku)" ]; then
  heroku container:release -a $app_name web
else
  echo "The heroku tool belt is required to deploy"
  exit 1
fi
